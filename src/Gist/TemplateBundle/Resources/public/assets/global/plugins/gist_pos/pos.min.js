function revertDiscounts(){"Deposit"==$("#string_trans_mode").val()?$("#cart_table").find("tr").each(function(){$(this).children("th").length>5&&($(this).find("th").eq(3).remove(),$(this).find("th").eq(3).remove(),$(this).find("th").eq(3).remove(),$(this).find("td").eq(0).css("width","350px"),$(this).find("td").eq(1).css("width","100px")),$(this).children("td").length>5&&($(this).find("td").eq(3).remove(),$(this).find("td").eq(3).remove(),$(this).find("td").eq(3).remove(),$(this).find("td").eq(0).css("width","350px"),$(this).find("td").eq(1).css("width","100px"))}):$("#cart_table").find("tr").each(function(){$(this).children("th").length>5&&($(this).find("th").eq(2).remove(),$(this).find("th").eq(2).remove(),$(this).find("th").eq(2).remove(),$(this).find("td").eq(0).css("width","350px"),$(this).find("td").eq(1).css("width","100px")),$(this).children("td").length>5&&($(this).find("td").eq(2).remove(),$(this).find("td").eq(2).remove(),$(this).find("td").eq(2).remove(),$(this).find("td").eq(0).css("width","350px"),$(this).find("td").eq(1).css("width","100px"))});var t=parseFloat($("#float_cart_orig_price").val());$("#string_trans_type").val("none"),$(".updated_totals_row").hide(),$(".checkout_btn").hide(),$(".bulk_adj").hide(),$("#customer_savings").text("0.00"),$(".next_step_btn").show(),$(".clear_discount").hide(),$(".initial_cart_price").text(addCommas(t)),$("#float_cart_new_price").val($("#float_cart_orig_price").val()),$("#cgroup-new_total").hide(),$("#cform-new_total").val(""),$("#cform-discount_amount").val(""),$("#cgroup-discount_amount").hide(),$("#cform-discount_pct").val(""),$("#cgroup-discount_pct").hide(),computeCartRaw(),$(".orig_totals_row").hide(),$(".orig_price_h3").hide(),$(".bulk_discount_h4").hide(),$("#applied_bulk_discount").text("")}function ajaxGetProductCategories(){$("#url_pos").val();var t=$("#url_erp").val();$("#pos_loc_id").val();$("#prod_cats").empty(),$("#prods").empty(),$("#prod_cats").append('<div style="height: 10px;">');var a=t+"/inventory/pos/get/product_categories";$.getJSON(a,function(t){$.each(t,function(t,a){var e="http://nahmdong.com/vitalhill/img/default.png";null!=a.image_url&&(e=a.image_url),$("#prod_cats").append('<li class="nav-item">                <a aria-controls="pills-'+a.id+'" aria-selected="false" class="nav-link" data-toggle="pill" href="#pills-'+a.id+'" id="pills-'+a.id+'" role="tab" onclick="ajaxGetProducts('+a.id+')">'+a.name+"</a>            </li>"),$("#prods").append('<div class="col-sm-6 col-12 item">            <a href="javascript:void(0)" style="text-decoration: none;" onclick="ajaxGetProducts('+a.id+')">                <div class="item-content">                    <img src='+e+'>                    <div class="item-details">                        <div class="item-title">'+a.name+"</div>                    </div>                </div>            </a>            </div>")})})}function ajaxGetProducts(t){$("#url_pos").val();var a=$("#url_erp").val(),e=$("#pos_loc_id").val();$("#prods").empty(),$("#prods").append('<div class="col-md-12"><h2>&nbsp;&nbsp;&nbsp;Loading products...</h2></div>'),$("#cat_btn_"+t).css({"background-color":"#484c50"}),$("#prods").empty();var s=a+"/inventory/pos/get/products/"+e+"/"+t;$.getJSON(s,function(t){var a=0;$.each(t,function(t,e){a++;var s=0,r=0;null!=e.srp&&(s=e.srp),null!=e.orig_srp&&(r=e.orig_srp);var c="http://nahmdong.com/vitalhill/img/default.png";null!=e.image_url&&(c=e.image_url),$("#prods").append('<div class="col-sm-6 col-12 item">            <a href="javascript:void(0)" style="text-decoration: none;" onclick="addToCart(\''+e.name.replace(/'/g,"")+"',"+s+","+e.min_price+","+e.id+",'"+e.barcode+"','"+e.item_code+'\')">                <div class="item-content" data-title='+e.name+" data-price="+r+">                    <img src="+c+" alt="+e.name+'>                    <div class="item-details">                        <div class="item-title">'+e.name+'</div>                        <div class="item-price">PHP '+r+"</div>                    </div>                </div>            </a>            </div>")}),0==a&&($("#prods").empty(),$("#prods").append('<div class="col-md-12"><div class="alert alert-warning"> <h2>&nbsp;&nbsp;No products in selected category</h2></div></div>'))})}function addToPayments(t,a,e,s,r,c,n,o,i,_,l,d,u,m,v){r=r||"",n=n||"",s=s||"",c=c||"",o=o||"",i=i||"",_=_||"",l=l||"",d=d||"",u=u||"",m=m||"",v=v||"",$(".init_row_payment").remove();var p='<tr class="row_payment_'+Math.round((new Date).getTime()+100*Math.random())+'">';p+='<input type="hidden" name="control_number" class="control_number" value="'+s+'">',p+='<input type="hidden" name="account_number" class="account_number" value="'+i+'">',p+='<input type="hidden" name="bank" class="bank" value="'+r+'">',p+='<input type="hidden" name="payment_issued_on" class="payment_issued_on" value="0">',p+='<input type="hidden" name="cc_terminal_opt" class="cc_terminal_opt" value="'+c+'">',p+='<input type="hidden" name="cc_interest" class="cc_interest" value="'+n+'">',p+='<input type="hidden" name="cc_terms" class="cc_terms" value="'+o+'">',p+='<input type="hidden" name="payee" class="payee" value="'+_+'">',p+='<input type="hidden" name="payor" class="payor" value="'+l+'">',p+='<input type="hidden" name="cc_expiry" class="cc_expiry" value="'+d+'">',p+='<input type="hidden" name="cc_cvv" class="cc_cvv" value="'+u+'">',p+='<input type="hidden" name="check_type" class="check_type" value="'+v+'">',p+='<input type="hidden" name="check_date" class="check_date" value="'+m+'">',p+='<input type="hidden" name="payment_details_array[]" class="payment_details_array" value="'+e+'" >',p+='<input type="hidden" name="payment_amt_float[]" class="payment_amt_float" value="'+a+'" >',p+='<td><input type="text" style="font-size: 12px !important;" name="payment_type[]" value="'+t+'" readonly="true" class="form-control payment_type"></td>',p+='<td><input type="text" style="font-size: 10px !important;" name="payment_amt[]" class="form-control payment_amt" readonly="true" value="'+addCommas(a)+'"></td>',p+='<td ><a href="javascript:void(0)" class="btn btn-xs default red remove_payment_row"><i class="fa fa-times" aria-hidden="true"></i></a></td>',p+="</tr>",$("#payments_list").prepend(p),toastr.success("Payment added","Success"),computeBalance()}function ajaxSearchCustomer(){var t="%20";$("#cform-cust_search_firstname").length&&""!=$("#cform-cust_search_firstname").val()&&(t=$("#cform-cust_search_firstname").val());var a="%20";$("#cform-cust_search_middle_name").length&&""!=$("#cform-cust_search_middle_name").val()&&(a=$("#cform-cust_search_middle_name").val());var e="%20";$("#cform-cust_search_lastname").length&&""!=$("#cform-cust_search_lastname").val()&&(e=$("#cform-cust_search_lastname").val());var s="%20";$("#cform-cust_search_email").length&&""!=$("#cform-cust_search_email").val()&&(s=$("#cform-cust_search_email").val());var r="%20";$("#cform-cust_search_mobile").length&&""!=$("#cform-cust_search_mobile").val()&&(r=$("#cform-cust_search_mobile").val());var c="%20";$("#cform-cust_search_id").length&&""!=$("#cform-cust_search_id").val()&&(c=$("#cform-cust_search_id").val());var n="%20";$("#cform-cust_search_gender").length&&$("input[name='cust_search_gender']").is(":checked")&&(n=$("input[name='cust_search_gender']:checked").val());var o="%20";$("#cform-cust_search_marital").length&&""!=$(".cust_search_marital").val()&&"undefined"!=$(".cust_search_marital").val()&&(o=$(".cust_search_marital").val());var i="%20";$("#cform-cust_search_marriage_date").length&&""!=$("#cform-cust_search_marriage_date").val()&&(i=$("#cform-cust_search_marriage_date").val());var _="%20";$("#cform-cust_search_home_phone").length&&""!=$("#cform-cust_search_home_phone").val()&&(_=$("#cform-cust_search_home_phone").val());var l="%20";$("#cform-cust_search_birthdate").length&&""!=$("#cform-cust_search_birthdate").val()&&(l=$("#cform-cust_search_birthdate").val());var d="%20";$("#cform-cust_search_address_1").length&&""!=$("#cform-cust_search_address_1").val()&&(d=$("#cform-cust_search_address_1").val());var u="%20";$("#cform-cust_search_address_2").length&&""!=$("#cform-cust_search_address_2").val()&&(u=$("#cform-cust_search_address_2").val());var m="%20";$("#cform-cust_search_city").length&&""!=$("#cform-cust_search_city").val()&&(m=$("#cform-cust_search_city").val());var v="%20";$("#cform-cust_search_state").length&&""!=$("#cform-cust_search_state").val()&&(v=$("#cform-cust_search_state").val());var p="%20";$("#cform-cust_search_country").length&&""!=$("#cform-cust_search_country").val()&&(p=$("#cform-cust_search_country").val());var h="%20";$("#cform-cust_search_zip").length&&""!=$("#cform-cust_search_zip").val()&&(h=$("#cform-cust_search_zip").val());$("#cform-cust_search_notes").length&&""!=$("#cform-cust_search_notes").val()&&$("#cform-cust_search_notes").val(),$("#customers_list").empty();$("#url_pos").val();var f=$("#url_erp").val()+"/customer/pos/search/"+t+"/"+e+"/"+s+"/"+r+"/"+a+"/"+c+"/"+n+"/"+o+"/"+i+"/"+_+"/"+l+"/"+d+"/"+u+"/"+m+"/"+v+"/"+p+"/"+h;f.replace("%2F",""),$.getJSON(f,function(t){var a=0;if($.each(t,function(t,e){a++;var s=e.last_name+", "+e.first_name;$(".init_row_customer").remove();var r='<tr class="row_cust_'+e.id+'">';r+='<input type="hidden" class="first_name" value="'+e.first_name+'">',r+='<input type="hidden" class="last_name" value="'+e.last_name+'">',r+='<input type="hidden" class="email" value="'+e.email+'">',r+='<input type="hidden" class="number" value="'+e.number+'">',r+='<input type="hidden" class="middle_name" value="'+e.middle_name+'">',r+='<input type="hidden" class="id" value="'+e.id+'">',r+='<input type="hidden" class="gender" value="'+e.gender+'">',r+='<input type="hidden" class="marital_status" value="'+e.marital_status+'">',r+='<input type="hidden" class="date_married" value="'+e.date_married+'">',r+='<input type="hidden" class="home_phone" value="'+e.home_phone+'">',r+='<input type="hidden" class="birthdate" value="'+e.birthdate+'">',r+='<input type="hidden" class="address1" value="'+e.address1+'">',r+='<input type="hidden" class="address2" value="'+e.address2+'">',r+='<input type="hidden" class="city" value="'+e.city+'">',r+='<input type="hidden" class="state" value="'+e.state+'">',r+='<input type="hidden" class="country" value="'+e.country+'">',r+='<input type="hidden" class="zip" value="'+e.zip+'">',r+='<input type="hidden" class="notes" value="'+e.notes+'">',r+='<input type="hidden" class="display_id" value="'+e.display_id+'">',r+='<td><input type="text" style="font-size: 12px !important;" name="customer_name[]" value="'+s+'" readonly="true" class="form-control customer_name"></td>',r+='<td><input type="text" style="font-size: 12px !important;" name="customer_email[]" class="form-control customer_email" readonly="true" value="'+e.email+'">',r+='<td><a href="javascript:void(0)" class="btn btn-xs default green view_customer_btn" data-toggle="tooltip" data-placement="bottom" title="View Customer"><i class="fa fa-eye" aria-hidden="true"></i></a>',r+='<a href="javascript:void(0)" class="btn btn-xs default blue use_customer_btn" data-toggle="tooltip" data-placement="bottom" title="Select Customer"><i class="fa fa-pencil" aria-hidden="true"></i></a></td>',r+="</tr>",$("#customers_list").prepend(r)}),0==a){var e='<tr class="init_row_prods">';e+='<td colspan="3"><p>No customer found &nbsp;&nbsp;&nbsp;</p></td>',e+="</tr>",$("#customers_list").prepend(e),swal("No customer found!","","error")}else{var s=document.getElementById("cust_formx");s.scrollTop=s.scrollHeight}})}function ajaxAddCustomer(){var t="%20";$("#cform-cust_search_firstname").length&&""!=$("#cform-cust_search_firstname").val()&&(t=$("#cform-cust_search_firstname").val());var a="%20";$("#cform-cust_search_middle_name").length&&""!=$("#cform-cust_search_middle_name").val()&&(a=$("#cform-cust_search_middle_name").val());var e="%20";$("#cform-cust_search_lastname").length&&""!=$("#cform-cust_search_lastname").val()&&(e=$("#cform-cust_search_lastname").val());var s="%20";$("#cform-cust_search_email").length&&""!=$("#cform-cust_search_email").val()&&(s=$("#cform-cust_search_email").val());var r="%20";$("#cform-cust_search_mobile").length&&""!=$("#cform-cust_search_mobile").val()&&(r=$("#cform-cust_search_mobile").val());$("#cform-cust_search_id").length&&""!=$("#cform-cust_search_id").val()&&$("#cform-cust_search_id").val();var c="%20";$("#cform-cust_search_gender").length&&$("input[name='cust_search_gender']").is(":checked")&&(c=$("input[name='cust_search_gender']:checked").val());var n="%20";$("#cform-cust_search_marital").length&&""!=$(".cust_search_marital").val()&&"undefined"!=$(".cust_search_marital").val()&&(n=$(".cust_search_marital").val());var o="%20";$("#cform-cust_search_marriage_date").length&&""!=$("#cform-cust_search_marriage_date").val()&&(o=$("#cform-cust_search_marriage_date").val());var i="%20";$("#cform-cust_search_home_phone").length&&""!=$("#cform-cust_search_home_phone").val()&&(i=$("#cform-cust_search_home_phone").val());var _="%20";$("#cform-cust_search_birthdate").length&&""!=$("#cform-cust_search_birthdate").val()&&(_=$("#cform-cust_search_birthdate").val());var l="%20";$("#cform-cust_search_address_1").length&&""!=$("#cform-cust_search_address_1").val()&&(l=$("#cform-cust_search_address_1").val());var d="%20";$("#cform-cust_search_address_2").length&&""!=$("#cform-cust_search_address_2").val()&&(d=$("#cform-cust_search_address_2").val());var u="%20";$("#cform-cust_search_city").length&&""!=$("#cform-cust_search_city").val()&&(u=$("#cform-cust_search_city").val());var m="%20";$("#cform-cust_search_state").length&&""!=$("#cform-cust_search_state").val()&&(m=$("#cform-cust_search_state").val());var v="%20";$("#cform-cust_search_country").length&&""!=$("#cform-cust_search_country").val()&&(v=$("#cform-cust_search_country").val());var p="%20";$("#cform-cust_search_zip").length&&""!=$("#cform-cust_search_zip").val()&&(p=$("#cform-cust_search_zip").val());var h="%20";$("#cform-cust_search_notes").length&&""!=$("#cform-cust_search_notes").val()&&(h=$("#cform-cust_search_notes").val());var f="%20";$("#string_consultant_id").length&&""!=$("#string_consultant_id").val()&&(f=$("#string_consultant_id").val());var g=$("#url_pos").val(),y=$("#url_erp").val()+"/customer/pos/add/"+t+"/"+e+"/"+s+"/"+r+"/"+a+"/"+c+"/"+n+"/"+o+"/"+i+"/"+_+"/"+l+"/"+d+"/"+u+"/"+m+"/"+v+"/"+p+"/"+h+"/"+f;$.getJSON(y,function(t){$.each(t,function(t,a){var e=g+"/settings/sync_customers";$.getJSON(e,function(t){$.each(t,function(t,e){swal("Success!","Customer added!","success"),$("#transaction_customer_id").val(a.new_customer_id),$("#customer_modal").modal("hide"),"none"!=$("#string_trans_type").val()&&parseFloat($("#float_trans_balance").val())<=0&&$("#final_modal").modal("show")})})})});var x=e+", "+t;$("#footer_customer").text(x),clearCustomerAdd()}function clearCustomerAdd(){$("#cform-cust_firstname").val(""),$("#cform-cust_lastname").val(""),$("#cform-cust_email").val(""),$("#cform-cust_mobile").val("")}function addDashes(t){x=(t+="").split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var a=/(\d+)(\d{3})/;a.test(x1);)x1=x1.replace(a,"$1-$2");return x1+x2}function addCommas(t){t=t.toFixed(2),t+="",x=t.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var a=/(\d+)(\d{3})/;a.test(x1);)x1=x1.replace(a,"$1,$2");return x1+x2}function round(t,a){return void 0===a||0==+a?Math.round(t):(t=+t,a=+a,isNaN(t)||"number"!=typeof a||a%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math.round(+(t[0]+"e"+(t[1]?+t[1]+a:a)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]-a:-a))))}function addToCart(t,a,e,s,r,c){var n=$("#string_trans_type").val(),o=$("#string_trans_mode").val();$(".init_row_prods").remove();var i='<tr class="row_prod_'+Math.round((new Date).getTime()+100*Math.random())+' product_row">';i+='<input type="hidden" name="product_id[]" class="product_id" value="'+s+'" >',i+='<input type="hidden" name="issued_on[]" class="issued_on" value="0" >',i+='<input type="hidden" name="barcode[]" class="barcode" value="'+r+'" >',i+='<input type="hidden" name="item_code[]" class="item_code" value="'+c+'" >',i+='<input type="hidden" name="min_price[]" class="min_price" value="'+e+'" >',i+='<input type="hidden" name="srp[]" class="srp" value="'+a+'" >',i+='<input type="hidden" name="product_amt[]" class="product_amt" value="'+a+'" >',i+='<td><input type="text" style="font-size: 10px !important;" value="'+t+'" readonly="true" class="form-control item_name"></td>',i+='<td><input type="text" style="font-size: 10px !important;" name="display_price[]" class="form-control display_price" readonly="true" value="'+a+'"></td>',i+='<td ><a href="javascript:void(0)" class="btn btn-xs default red remove_row"><i class="fa fa-times" aria-hidden="true"></i></a></td>',i+="</tr>",$("#cart_items").prepend(i),"Deposit"==o&&appendDepositItemFields(),"per"==n&&appendPerItemFields();var _=$("#cart_table tr").length-1;$(".cart_items_count").text(_.toString()),"none"==n?computeCartRaw():"per"==n?(computeCartRaw(),computeCartIndiv()):"reg"==n?computeCartRaw():"bulk"==n&&(computeCartRaw(),applyBulkAdjustment()),computeBalance()}function computeBalance(){var t=0,a=parseFloat($("#float_trans_amount").val()),e=parseFloat($("#float_static_trans_amount").val()),s=0;$(".payment_amt_float").each(function(){t+=parseFloat($(this).val())});var r=parseFloat($("#float_trans_refund_amount").val());s="true"==$("#flag_refund").val()?e-t-r+a:a-t,$("#float_trans_balance").val(s),$(".co_balance").text(addCommas(s)),$(".co_balance_static").text(addCommas(s)),$(".co_balance_disp").text(addCommas(s)),computeVATBalance(s),"true"==$("#flag_refund").val()&&computeRefundTotal()}function computeBalanceDisplay(t){var a,e=t;a=$("#float_trans_balance").val()-e,$(".co_balance_disp").text(addCommas(a))}function computeBalanceDisplayCardMulti(){var t,a=0,e=$("#float_trans_balance").val();$(".cc_field").each(function(){var t=parseFloat($(this).find("#cform-cc_charge_amt").val());""!=t&&t>0&&(a=parseFloat(a)+parseFloat(t))}),t=parseFloat(e)-parseFloat(a),$(".co_balance_disp").text(addCommas(t))}function computeBalanceDisplayCheckMulti(){var t,a=0,e=$("#float_trans_balance").val();$(".check_field").each(function(){var t=$(this).find("#cform-check_amount").val();""!=t&&t>0&&(a=parseFloat(a)+parseFloat(t))}),t=parseFloat(e)-parseFloat(a),$(".co_balance_disp").text(addCommas(t))}function computeCartRaw(){var t=0,a=0;$(".display_price").each(function(){t+=parseFloat($(this).val())}),$(".min_price").each(function(){a+=parseFloat($(this).val())}),$("#float_cart_orig_price").val(t),$("#float_cart_minimum_total").val(a),$(".initial_cart_price").text(addCommas(t)),$(".updated_cart_price").text(addCommas(t)),$(".transaction_total").text(addCommas(t)),$("#transaction_amt_to_pay").val(addCommas(t)),$("#float_trans_amount").val(t),computeVATRaw(t),computeCartMinimum()}function computeCartIndiv(){var t=0;$(".adjusted_price").each(function(){t+=parseFloat($(this).val())});var a=$("#float_cart_orig_price").val()-t;$("#customer_savings").text(addCommas(parseFloat(a))),$("#float_cart_new_price").val(t),$(".updated_cart_price").text(addCommas(t)),$(".transaction_total").text(addCommas(t)),$("#transaction_amt_to_pay").val(addCommas(t)),$("#float_trans_amount").val(t),computeVATIndiv(t),computeCartMinimum()}function computeCartBulk(t){$("#float_cart_new_price").val(t),$(".updated_cart_price").text(addCommas(t)),$(".transaction_total").text(addCommas(t)),$("#transaction_amt_to_pay").val(addCommas(t)),$("#float_trans_amount").val(t),computeVATIndiv(t),computeCartMinimum()}function computeVATRaw(t){var a=parseFloat($("#float_tax_rate").val())/100,e=a+1,s=$("#string_tax_coverage").val(),r=0,c=0,n=a+1;"incl"==s?(c=t-(r=t/e*a),$("#float_new_tax_vat_amt").val(round(r,2)),$("#float_new_tax_amt_net_vat").val(round(c,2)),$("#float_orig_tax_vat_amt").val(round(r,2)),$("#float_orig_tax_amt_net_vat").val(round(c,2)),$("#initial_amt_net_vat").text(addCommas(round(c,2))),$("#initial_vat_amt").text(addCommas(round(r,2))),$("#updated_amt_net_vat").text(addCommas(round(c,2))),$("#updated_vat_amt").text(addCommas(round(r,2)))):"excl"==s?(c=t-(r=t-t/n),$("#float_new_tax_vat_amt").val(round(r,2)),$("#float_new_tax_amt_net_vat").val(round(c,2)),$("#float_orig_tax_vat_amt").val(round(r,2)),$("#float_orig_tax_amt_net_vat").val(round(c,2)),$("#initial_amt_net_vat").text(addCommas(round(c,2))),$("#initial_vat_amt").text(addCommas(round(r,2))),$("#updated_amt_net_vat").text(addCommas(round(c,2))),$("#updated_vat_amt").text(addCommas(round(r,2)))):($("#cart_new_amt_vat").text("No vat set in ERP"),$("#cart_new_vat").text("No vat set in ERP"))}function computeVATIndiv(t){var a=parseFloat($("#float_tax_rate").val())/100,e=a+1,s=$("#string_tax_coverage").val(),r=0,c=0,n=a+1;"incl"==s?(c=t-(r=t/e*a),$("#float_new_tax_vat_amt").val(round(r,2)),$("#float_new_tax_amt_net_vat").val(round(c,2)),$("#updated_amt_net_vat").text(addCommas(round(c,2))),$("#updated_vat_amt").text(addCommas(round(r,2)))):"excl"==s?(c=t-(r=t-t/n),$("#float_new_tax_vat_amt").val(round(r,2)),$("#float_new_tax_amt_net_vat").val(round(c,2)),$("#updated_amt_net_vat").text(addCommas(round(c,2))),$("#updated_vat_amt").text(addCommas(round(r,2)))):($("#cart_new_amt_vat").text("No vat set in ERP"),$("#cart_new_vat").text("No vat set in ERP"))}function proceedToTransaction(t){var a=t;""!=a?"reg"==a?($(".reason_refund_proceed_btn").hide(),$(".next_step_btn").hide(),$(".checkout_btn").show(),$("#transaction_type_modal").modal("hide"),$(".savings_h4").hide(),$(".clear_discount").show(),$("#string_trans_type").val("reg")):"per"==a?($("#string_trans_type").val("per"),$(".reason_refund_proceed_btn").hide(),$(".next_step_btn").hide(),$(".savings_h4").show(),$(".checkout_btn").show(),appendPerItemColumns(),appendPerItemFields(),$("#transaction_type_modal").modal("hide"),$(".updated_totals_row").show(),$(".clear_discount").show()):"bulk"==a?($("#string_trans_type").val("bulk"),$(".updated_totals_row").show(),$(".reason_refund_proceed_btn").hide(),$(".next_step_btn").hide(),$(".savings_h4").show(),$(".bulk_adj").show(),$("#proc").show(),$("#transaction_type_modal").modal("hide"),$("#bulk_adjustment").modal("show"),$(".bulk_discount_h4").show(),$(".checkout_btn").show(),$(".clear_discount").show()):($(".clear_discount").hide(),$("#string_trans_type").val("none")):($(".clear_discount").hide(),$("#string_trans_type").val("none"))}function computeCartMinimum(){var t=0;if($(".min_price").each(function(){t+=parseFloat($(this).val())}),"normal"==$("#string_trans_mode").val())a=(a=$("#transaction_parent_ea").val()).replace(/-/g,"");else var a="0";var e=parseFloat($("#float_cart_orig_price").val())+parseInt(a),s=parseFloat($("#float_cart_new_price").val())+parseInt(a);$("#float_cart_minimum_total").val(t),"none"==$("#string_trans_type").val()?t>e?$(".updated_price_h3").css({color:"red"}):$(".updated_price_h3").css({color:"black"}):t>s?$(".updated_price_h3").css({color:"red"}):$(".updated_price_h3").css({color:"black"}),computeExtraAmount()}function apply_indiv(t){var a=$(t).closest("tr"),e=a.find(".srp").val(),s=a.find(".adjusted_price"),r=a.find(".per_item_discount_amt");"gift"==$(t).val()?(s.val(0),r.attr("readonly",!0),r.val("")):"disc"==$(t).val()?(s.val(e),r.val(""),r.attr("readonly",!1)):"chg"==$(t).val()?(s.val(e),r.val(""),r.attr("readonly",!1)):"discamt"==$(t).val()?(s.val(e),r.val(""),r.attr("readonly",!1)):(s.val(e),r.attr("readonly",!0),r.val("")),computeCartIndiv(),computeBalance()}function applyBulkAdjustment(){var t=$("#bulk_opt_sel").val();if(""!=t)if("bgift"==t)computeCartBulk(0),$("#string_trans_bulk_type").val("Gift"),$("#applied_bulk_discount").text("Gift"),$("#bulk_opt_amt").val("0"),computeCartBulk(parseFloat("0.00"));else if("bdiscamt"==t){(a=$("#float_cart_orig_price").val()-$("#cform-discount_amount").val())>=0?($("#applied_bulk_discount").text("Less Php "+$("#cform-discount_amount").val()),$("#customer_savings").text(addCommas(parseFloat($("#cform-discount_amount").val()))),$("#string_trans_bulk_type").val("Less Php "+$("#cform-discount_amount").val()),$("#bulk_opt_amt").val($("#cform-discount_amount").val()),computeCartBulk(a)):toastr.error("Invalid discount amount.","Error")}else if("bdisc"==t){var a=$("#float_cart_orig_price").val()-$("#float_cart_orig_price").val()*($("#cform-discount_pct").val()/100),e=$("#float_cart_orig_price").val()*($("#cform-discount_pct").val()/100);a>=0?(computeCartBulk(a),$("#applied_bulk_discount").text("Less "+$("#cform-discount_pct").val()+" percent off"),$("#string_trans_bulk_type").val("Less "+$("#cform-discount_pct").val()+" percent off"),$("#customer_savings").text(addCommas(parseFloat(e))),$("#bulk_opt_amt").val($("#cform-discount_pct").val())):toastr.error("Invalid discount.","Error")}else if("bamt"==t){e=$("#float_cart_orig_price").val()-$("#cform-new_total").val();computeCartBulk(parseFloat($("#cform-new_total").val())),$("#applied_bulk_discount").text("Change Amount"),$("#string_trans_bulk_type").val("Change Amount to pay to: Php "+$("#cform-new_total").val()),$("#customer_savings").text(addCommas(parseFloat(e))),$("#bulk_opt_amt").val($("#cform-new_total").val())}else $("#string_trans_bulk_type").val("none"),$("#bulk_opt_amt").val("0"),$(".display_price").each(function(){if("0"==$(this).val()||"0.00"==$(this).val()){var t=$(this).closest("tr").find(".srp").val();$(this).val(t)}}),$("#applied_bulk_discount").text(""),computeCartBulk(0);else $("#string_trans_bulk_type").val("none");computeBalance()}function updateBulkForm(t){var a=t;$(".indiv_adj").each(function(){$(this).hide()}),"bgift"==a?($("#bulk_opt_sel").val("bgift"),$("#cform-discount_amount").val(""),$("#cgroup-discount_amount").hide(),$("#cform-discount_pct").val(""),$("#cform-selected_bulk").val("Gift"),$("#cgroup-discount_pct").hide(),$("#cform-new_total").val(""),$("#cgroup-new_total").hide()):"bamt"==a?($("#bulk_opt_sel").val("bamt"),$("#cform-discount_amount").val(""),$("#cgroup-discount_amount").hide(),$("#cform-discount_pct").val(""),$("#cform-selected_bulk").val("Change Amount to Pay"),$("#cgroup-discount_pct").hide(),$("#cgroup-new_total").show()):"bdiscamt"==a?($("#bulk_opt_sel").val("bdiscamt"),$("#cgroup-discount_amount").show(),$("#cform-discount_pct").val(""),$("#cform-selected_bulk").val("Discount Amount"),$("#cgroup-discount_pct").hide(),$("#cform-new_total").val(""),$("#cgroup-new_total").hide()):"bdisc"==a?($("#bulk_opt_sel").val("bdisc"),$("#cform-discount_amount").val(""),$("#cgroup-discount_amount").hide(),$("#cform-selected_bulk").val("Discount %"),$("#cgroup-discount_pct").show(),$("#cform-new_total").val(""),$("#cgroup-new_total").hide()):($("#bulk_opt_amt").val("0"),$("#bulk_opt_sel").val("na"),cancelBulkAdjustment())}function clearCreditCardModal(){$("#cc_form").empty(),$("#cc_fields").children().clone(!0,!0).find("input").val("").end().appendTo("#cc_form")}function clearCheckModal(){$("#check_form").empty(),$("#check_fields").clone().find("input").val("").end().appendTo("#check_form")}function hideBulkAmounts(){$("#cform-discount_amount").val(""),$("#cgroup-discount_amount").hide(),$("#cform-discount_pct").val(""),$("#cgroup-discount_pct").hide(),$("#cform-new_total").val(""),$("#cgroup-new_total").hide()}function cancelBulkAdjustment(){revertOriginalPrices(),$("#cgroup-new_total").hide(),$("#cform-new_total").val(""),$("#cform-discount_amount").val(""),$("#cgroup-discount_amount").hide(),$("#cform-discount_pct").val(""),$("#cgroup-discount_pct").hide(),$(".display_price").each(function(){if("0"==$(this).val()||0==$(this).val()){var t=$(this).closest("tr").find(".srp").val();$(this).val(t)}})}function revertOriginalPrices(){$(".display_price").each(function(){if("0"==$(this).val()||0==$(this).val()){var t=$(this).closest("tr").find(".srp").val();$(this).val(t)}}),computeCartMinimum()}function freezeTransaction(t){t=t||!1;var a=!1,e=!1,s=$("#cart_items .product_row").length,r=$("#payments_table .init_row_payment").length,c=$("#pos_loc_id").val(),n=$("#float_trans_amount").val(),o=$("#float_trans_ea").val(),i=$("#float_trans_balance").val(),_=$("#string_trans_mode").val(),l=$("#string_trans_type").val(),d=$("#string_trans_bulk_type").val(),u=$("#bulk_opt_sel").val(),m=$("#bulk_opt_amt").val(),v=$("#float_tax_rate").val(),p=$("#float_orig_tax_vat_amt").val(),h=$("#float_new_tax_vat_amt").val(),f=$("#float_orig_tax_amt_net_vat").val(),g=$("#float_new_tax_amt_net_vat").val(),y=$("#string_tax_coverage").val(),x=$("#float_cart_minimum_total").val(),b=$("#float_cart_orig_price").val(),w=$("#float_cart_new_price").val(),k=$("#string_trans_cc_interest").val(),C=$("#transaction_reference_sys_id").val(),F=$("#flag_upsell").val(),T=$("#flag_refund").val(),P=$("#string_refund_method").val(),B=$("#float_trans_refund_amount").val(),j=$("#float_trans_deposit_amount").val(),z=$("#float_deposit_tax_amt_net_vat").val(),N=$("#float_deposit_tax_vat_amt").val(),q=$("#float_balance_tax_amt_net_vat").val(),S=$("#float_balance_tax_vat_amt").val(),A=$("#float_trans_gc_credit").val(),R=$("#float_trans_gc_debit").val(),D=$("#cform-refund_reason").val();D.length<1&&(D="%20");var I=parseFloat(A),M=0;$("#cart_items tr").each(function(){var t=$(this).closest("tr"),a=t.find(".barcode").val(),e=t.find(".srp").val();"GC"==a&&(M+=parseFloat(e)),A=I+M});var E="false";s>0&&"refund"==_&&(E="true"),"true"==T&&(n=$("#ovr_float_trans_amount").val(),p=$("#ovr_float_orig_tax_vat_amt").val(),h=$("#ovr_float_new_tax_vat_amt").val(),f=$("#ovr_float_orig_tax_amt_net_vat").val(),g=$("#ovr_float_new_tax_amt_net_vat").val(),b=$("#ovr_float_cart_orig_price").val(),w=$("#ovr_float_cart_new_price").val());var O=$("#url_pos").val(),J=($("#url_erp").val(),"Frozen");t&&(J="Paid");var G=$("#transaction_customer_id").val(),V=O+"/pos/save_transaction/"+c+"/"+n+"/"+i+"/"+l+"/"+G+"/"+J+"/"+v+"/"+p+"/"+h+"/"+f+"/"+g+"/"+y+"/"+x+"/"+b+"/"+w+"/"+d+"/"+_+"/"+k+"/"+o+"/"+j+"/"+z+"/"+N+"/"+q+"/"+S+"/"+C+"/"+u+"/"+m+"/"+F+"/"+P+"/"+B+"/"+E+"/"+A+"/"+R+"/"+D;$.getJSON(V,function(c){$.each(c,function(c,n){a=!0,$("#transaction_system_id").val(n.new_id),n.new_id,$("#existing_cart_items tr").each(function(){var t=$(this).closest("tr"),a=t.find(".existing_product_id").val(),s=t.find(".existing_srp").val(),r=t.find(".existing_min_price").val(),c=t.find(".existing_item_name").val(),o=t.find(".existing_barcode").val(),i=t.find(".existing_item_code").val(),l="%20",d="%20",u=t.find(".existing_srp").val(),m="true",v="false",p=t.find(".existing_issued_on").val();if("Deposit"!=_&&(p="%20"),"per"==$("#string_parent_trans_type").val()){var h=t.find(".existing_indiv_disc_opt").val(),f=t.find(".existing_per_item_discount_amt").val(),g=t.find(".existing_adjusted_price").val();l=h.length>0?h:"%20",d=f.length>0?f:"%20",u=g.length>0?g:"%20"}"Deposit"==_&&(m="false"),"frozen"==_&&(m="false"),t.find(".refund_issued").is(":checked")&&(v="true");var y=O+"/pos/save_item/"+n.new_id+"/"+a+"/"+c+"/"+s+"/"+r+"/"+u+"/"+l+"/"+d+"/"+o+"/"+i+"/"+m+"/"+p+"/"+v;$.getJSON(y,function(t){$.each(t,function(t,a){e=!0})})}),s>0?$("#cart_items tr").each(function(){var t=$(this).closest("tr"),a=t.find(".product_id").val(),s=t.find(".srp").val(),r=t.find(".min_price").val(),c=t.find(".item_name").val(),o=t.find(".barcode").val(),i=t.find(".item_code").val(),d="%20",u="%20",m=t.find(".srp").val(),v="true",p=t.find(".issued_on").val();if("Deposit"!=_&&(p="%20"),"per"==l){var h=t.find(".pos_indiv_discount_opt").val(),f=t.find(".per_item_discount_amt").val(),g=t.find(".adjusted_price").val();d=h.length>0?h:"%20",u=f.length>0?f:"%20",m=g.length>0?g:"%20"}"Deposit"==_&&(v=t.find(".check_issued").is(":checked")?"true":"false"),"frozen"==_&&(v="false");var y=O+"/pos/save_item/"+n.new_id+"/"+a+"/"+c+"/"+s+"/"+r+"/"+m+"/"+d+"/"+u+"/"+o+"/"+i+"/"+v+"/"+p+"/new";$.getJSON(y,function(t){$.each(t,function(t,a){e=!0})})}):(e=!0,t?swal({title:"Transaction Saved!",text:"Please wait for data sync",type:"success",timer:4e3,showConfirmButton:!1},function(){syncToERP()}):swal({title:"Transaction Frozen!",text:"The page will now reload",type:"success",timer:4e3,showConfirmButton:!1},function(){syncToERP()})),0==r&&"none"!=l?$("#payments_list tr").each(function(){var s=$(this).find(".payment_type").val(),r=$(this).find(".payment_amt_float").val(),c=$(this).find(".payment_issued_on").val(),o="%20";""!=$(this).find(".control_number").val()&&(o=$(this).find(".control_number").val());var i="%20";""!=$(this).find(".account_number").val()&&(i=$(this).find(".account_number").val());var _="%20";""!=$(this).find(".bank").val()&&(_=$(this).find(".bank").val());var l="%20";""!=$(this).find(".cc_terminal_opt").val()&&(l=$(this).find(".cc_terminal_opt").val());var d="%20";""!=$(this).find(".cc_interest").val()&&(d=$(this).find(".cc_interest").val());var u="%20";""!=$(this).find(".cc_terms").val()&&(u=$(this).find(".cc_terms").val());var m="%20";""!=$(this).find(".payee").val()&&(m=$(this).find(".payee").val());var v="%20";""!=$(this).find(".payor").val()&&(v=$(this).find(".payor").val());var p="%20";""!=$(this).find(".cc_expiry").val()&&(p=$(this).find(".cc_expiry").val());var h="%20";""!=$(this).find(".cc_cvv").val()&&(h=$(this).find(".cc_cvv").val());var f="%20";""!=$(this).find(".check_type").val()&&(f=$(this).find(".check_type").val());var g="%20";""!=$(this).find(".check_date").val()&&(g=$(this).find(".check_date").val());var y=O+"/pos/save_payment/"+n.new_id+"/"+s+"/"+r+"/"+o+"/"+_+"/"+l+"/"+d+"/"+u+"/"+i+"/"+m+"/"+v+"/"+p+"/"+h+"/"+c+"/"+f+"/"+g;$.getJSON(y,function(s){$.each(s,function(s,r){a?(e||setTimeout(function(){},2e3),t?swal({title:"Transaction Saved!",text:"Please wait for data sync",type:"success",timer:6e3,showConfirmButton:!1},function(){syncToERP()}):swal({title:"Transaction Frozen!",text:"The page will now reload",type:"success",timer:6e3,showConfirmButton:!1},function(){syncToERP()})):a||(swal("Error encountered!","There was a problem saving this transaction","error"),location.reload())})})}):(!0,t?swal({title:"Transaction Saved!",text:"Please wait for data sync",type:"success",timer:2e3,showConfirmButton:!1},function(){syncToERP()}):swal({title:"Transaction Frozen!",text:"The page will now reload",type:"success",timer:2e3,showConfirmButton:!1},function(){syncToERP()}))})}),setTimeout(function(){var t=O+"/pos/save_def_split/"+$("#transaction_system_id").val();$.getJSON(t,function(t){$.each(t,function(t,a){a.status})})},4e3)}function resetCustomerModal(){clearCustomerFields(),$("#customer_modal").modal("hide"),$(".customer_seach_main_div").show(),$(".customer_search_btn").show(),$(".customer_clear_search_btn").show(),$(".add_customer").show(),$(".customer_continue_btn").hide(),$(".customer_search_again_btn").hide(),$("#customers_list").empty();var t='<tr class="init_row_prods">';t+='<td colspan="3"><p>No customer found &nbsp;&nbsp;&nbsp;</p></td>',t+="</tr>",$("#customers_list").prepend(t)}function clearCustomerFields(){$(".cust_search_gender").prop("checked",!1),$("#uniform-cform-cust_search_gender > span").removeClass("checked"),$("#cform-cust_search_id").val(""),$("#cform-cust_search_firstname").val(""),$("#cform-cust_search_middle_name").val(""),$("#cform-cust_search_lastname").val(""),$("#cform-cust_search_home_phone").val(""),$("#cform-cust_search_mobile").val(""),$("#cform-cust_search_email").val(""),$("#cform-cust_search_birthdate").val(""),$("#cform-cust_search_address_1").val(""),$("#cform-cust_search_address_2").val(""),$("#cform-cust_search_city").val(""),$("#cform-cust_search_state").val(""),$("#cform-cust_search_country").val(""),$("#cform-cust_search_zip").val(""),$("#cform-cust_search_marriage_date").val(""),$("#cform-notes").val(""),$(".cust_search_marital").prop("selectedIndex",0),$(".posgrp_cust_search_marriage_date").hide()}